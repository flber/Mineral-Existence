<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Mineral Existence</title>
		<link rel="icon" href="favicon.ico?" type="image/x-icon">
		<link rel="stylesheet" href="style.css"/>
	</head>
	<body id="dark">
		<nav>
			<div style="display:flex; align-items: center;"> 
				<div class="right-border">
					<span class="dark"><h1><a href="home.html">Home</a></h1></span>
					<span class="light"><h1><a href="home.html#dark">Home</a></h1></span>
				</div>
				<div class="right-border">
					<span class="dark"><h1><a href="now.html">now</a></h1></span>
					<span class="light"><h1><a href="now.html#dark">now</a></h1></span>
				</div>
				<div class="right-border">
					<span class="dark"><h1><a href="wiki.html">wiki</a></h1></span>
					<span class="light"><h1><a href="wiki.html#dark">wiki</a></h1></span>
				</div>
				<div class="right-border">
					<span class="dark"><h1><a href="about.html">about</a></h1></span>
					<span class="light"><h1><a href="about.html#dark">about</a></h1></span>
				</div>
				<div style="margin-left: auto;">
					<span class="dark"><b><a href="#dark">{dark}</a></b></span>
					<span class="light"><b><a href="#">{light}</a></b></span>
				</div>
				<div style="clear: both;"></div>
			</div>
		</nav>
		<article class="inner">

<h2>Uxn Notes</h2>

<p><a href="https://wiki.xxiivv.com/site/uxn.html">Uxn</a> is an 8-bit virtual stack machine, created by <a href="https://wiki.xxiivv.com/site/devine_lu_linvega.html">Devine</a>, and programmed in <a href="https://wiki.xxiivv.com/site/uxambly.html">uxnambly</a>, a unique flavor of assembly. </p>
<p>These are my notes for it.</p>

<h3>Breakdown of "Hello world"</h3>
<pre>
( dev/console )

%RTN { JMP2r }

( devices )

|10 @Console    [ &pad $8 &char $1 ]

( init )

|0100 ( -> )
	
	;hello-world ;print JSR2
	
BRK

@print ( addr -- )
	
<p>	&loop</p>
		( send ) DUP2 GET .Console/char DEO
		( incr ) #0001 ADD2
		( loop ) DUP2 GET #00 NEQ ,&loop JNZ
<p>	POP2</p>

RTN

@hello-world [ "Hello 20 "World! ]
</pre>

<p>In uxn, everything is a stack of data. This often means that commands seem backward, as data is added to that stack before operations can use it.</p>

<p>The second line (`%RTN { JMP2r }`) simply declares a macro labeled "RTN" which returns the two bytes at the top of the stack.</p>

<p>The next line is very interesting, and definitely confused me for a while!</p>
<pre>
|10 @Console    [ &pad $8 &char $1 ]
└──────────┘      └─────┘ └──────┘
      A              B       C
</pre>
<p>Part A starts the line by making sense. It defines a label: "Console", which is an address to the console device (at 0110). </p>
<p>Part B is where things start to get a bit confusing, and where Devine's <a href="https://wiki.xxiivv.com/site/uxnemu.html">devices</a> table is very helpful. The first part, `&pad`, defines a sub-label (of `Console`), which is assigned by the `$8` part to an address one byte further than the `Console` address. If you look at the previously mentioned table, you'll see that this puts us right up to the output section of the console's memory space. This sub-label is never actually called.</p>
<p>Part C then uses the same method as part B to assign the sub-label `char` to one bit past the `pad` label, which is the start of the "char" section of the console device!</p>

<p>The main part of the program starts with the line `|0100 ( -> )`, which moves us into the "system" device's memory space.</p>
<pre>
;hello-world ;print JSR2
└──────────┘ └────┘ └──┘
      A        B     C
</pre>
<p>Part A gets the address of the `hello-world` label and adds to the top of the stack. Part B then gets the address of the `print` label and pushes that to the stack, moving the first label down (really down four bytes, because each label is two bytes). The `JSR` opcode jumps the program to an address popped from the top of the stack, and the `2` modifier tells it to use two byte addresses. Because the top address is to `print`, we now move there.</p>

<p>The main part of the `print` section is in the `( send )` line, where the program outputs to the terminal.</p>
<pre>
( send ) DUP2 GET .Console/char DEO
└──────┘ └──┘ └─┘ └───────────┘ └─┘
   A      B    C        D        E
</pre>
<p>Part A is just a comment.</p>
<p>Part B duplicates the top two bytes of the stack, which here is the address to the `print` section. </p>
<p>Part C consumes and adds the top item to the stack, which is that address to `print`</p>
<p>Part D adds the device address for the console's char byte to the stack.</p>
<p>Part E consumes both the device address and the address of the `print` label, which is essentially the first byte of the `"hello 20 "world` string. </p>

<p>The next two lines make a bit more sense, but can be a bit unintuitive if you aren't used to working with memory address (like I am).</p>
<pre>
( incr ) #0001 ADD2
</pre>
<p>This is relatively straight-forward, it adds one byte to the item at the top of the stack, which is... the `print` address! Thus, the program now has an address on the top of the stack which points to the second byte in the `"hello 20 "world` string.</p>

<p>While a bit scary, I promise this next line isn't too complicated!</p>
<pre>
( loop ) DUP2 GET #00 NEQ ,&loop JNZ
         └──────┘ └─────┘ └────────┘
            A        B         C
</pre>
<p>At part A we duplicate and `GET` the two bytes at the top of the stack (remember, that's now the address to the next byte of our string), and the value at that address is compared to `#00`, the ascii null char, at part B. The `NEQ` opcode, as the name suggests, checks if its inputs are not equal. If they aren't equal, it returns a 1, and if they are equal it returns a 0.</p>
<p>Part C starts by adding the literal relative address of the `&loop` sub-label to the stack, and then the conditional jump operator, `JNZ`, uses the previous boolean added by part B to decide if it should jump to that address.</p>
<p>In this way, the loop repeats, printing each byte, until it hits a null byte, at which point it stops and returns.</p>

<p>And there we have it: Hello world!</p>
		</article>
		<footer>
			<nav aria-label="Contact links">
				<div style="float: left; margin-top: -3px;">
					<a href="mailto:benrhammond@gmail.com" aria-label="Email adress" title="Email adress"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 1280 1280"><path d="M614.5.6c-21.6 1.3-39.1 2.8-53 4.5-99.5 12.2-192.7 46.7-276 102.2-90.7 60.4-164.8 143.3-214.6 240.2-39.5 76.9-61.5 154.9-69 245-1.7 19.3-1.7 75.7 0 95 7.5 90.1 29.5 168.1 69 245 61 118.8 157.8 215.6 276.6 276.6 76.9 39.5 154.9 61.5 245 69 19.3 1.7 75.7 1.7 95 0 90.1-7.5 168.1-29.5 245-69 118.7-61 215.6-157.9 276.6-276.6 39.5-76.9 61.5-154.9 69-245 1.7-19.3 1.7-75.7 0-95-7.5-90.1-29.5-168.1-69-245-61-118.8-157.8-215.6-276.6-276.6-75.3-38.7-153.1-61-239-68.4-16.4-1.5-66.6-2.7-79-1.9zm73.9 77.9c109.8 9.4 212.1 49.9 300.1 118.8 40.1 31.4 80.4 73.8 110.6 116.2 59.8 84 94.4 179.3 103 284 1.6 19.3 1.6 65.7 0 85-11.4 138.5-69.3 262.8-167.2 359.1-96 94.2-217.2 149.4-352.4 160.5-19.3 1.6-65.7 1.6-85 0-135.2-11.1-256.1-66.1-352.3-160.5-97.9-96-156.1-221-167.3-359.1-1.5-19.3-1.5-65.7 0-85 11.2-138.4 69.3-262.9 167.8-359.6C332.9 152.3 444.2 97.6 564 81.6c41.6-5.5 83.2-6.6 124.4-3.1z"/><path d="M624.3 290c-59.9 3-109.9 15.3-159.3 39.1-70 33.8-120.1 84.5-157.4 159.4-24.3 48.9-38.3 99.9-42.7 155.9-2.4 30-.3 75.5 4.6 104.2 8.6 49.5 28 99.6 53.2 137.8 43.7 65.9 115.7 111 209.8 131.5 43.1 9.4 79.7 12.6 133.5 11.8 35.7-.5 53.5-2 81.1-6.7 65.8-11.3 123.2-36.1 167.4-72.5 11.7-9.7 31.5-29.7 40.3-40.8 8.8-11.1 20.1-28.5 26.6-40.8 3.1-5.8 5.6-10.9 5.6-11.2 0-.4-17.9-.7-39.7-.6h-39.8l-7 8.5c-38.3 46.7-99.5 77.4-176.7 88.8-41.7 6.2-104.4 6.2-146.1.1-61.3-9.1-114.4-30.2-152.2-60.6-39.9-32.1-70.3-81.2-84.5-136.4-16.1-62.7-10.3-139.9 15.6-208.5 23.4-61.6 59.1-107.6 108.9-140.2 40.3-26.4 84.9-41.1 143-46.9 15.5-1.6 59.6-1.6 75 0 65.7 6.6 115 27.8 153.2 65.9 36.8 36.6 57.4 80.1 62.4 131.7 1.6 16.8.7 44.7-2.1 61-11 65.1-49.7 124.8-100.4 155.3-11.5 6.9-24.7 11-31.1 9.6-10.2-2.2-13.6-10.9-11-28.7 1.7-12.4 1.2-9.7 20.5-103.7 3.9-19 7.5-36.5 8-39s4.1-20 8-39c3.9-19 7.5-36.5 8-39s4.1-20 8-39c3.9-19 7.4-36 7.7-37.8l.6-3.2h-99l-4.3 19.7c-2.3 10.9-4.5 20.4-4.9 21-.4.8-2.7-1.5-6.1-6.3-14.5-20.3-36.3-34.5-62.2-40.7-8.2-1.9-12.1-2.2-31.8-2.1-19.6 0-23.9.3-33 2.2-32.3 7-59.5 21.5-83.8 44.7-40.1 38.2-70 95.2-80.6 153.5-4.3 23.3-5.9 58.9-3.6 79.5 4.4 39 18 70 41.5 94.4 20 20.8 43.8 34 71.6 39.7 10.4 2.1 38.5 3 49 1.5 29.2-4.2 54.6-16.4 77.3-37.2 3.1-2.8 5.8-5 5.9-4.8.1.2 1.1 2.9 2.1 5.9 4.1 12.2 14 24.1 24.5 29.5 9.8 4.9 19 6.7 37.8 7.2 82.1 2.5 151.7-36.4 202.7-113.4 40-60.4 55.7-128.3 47-202.3-5.9-50.2-24.8-99.7-53.2-139.4-48.1-67.1-129.9-109.5-226.7-117.5-18.6-1.5-43.4-2-61.2-1.1zm6.2 227.5c24.8 5.2 44.8 26.2 51.9 54.6 3.7 14.9 4.7 37.7 2.5 57.7-2.6 24.2-11.1 57.2-21.5 83-9.9 24.7-18.8 38.8-34.3 54.3-15.5 15.5-30.3 23.3-49.7 26-21.5 3-39.8-3.4-54.9-19.3-15.1-15.8-22.5-40.3-22.5-74.7 0-44.4 16.1-104.1 36.3-134.6 23.6-35.7 59.2-53.9 92.2-47z"/></svg></a>
					<a href="https://merveilles.town/@flbr" aria-label="Fediverse account" title="Fediverse account"><svg xmlns="http://www.w3.org/2000/svg" baseProfile="full" aria-hidden="true" viewBox="0 0 220 220": ><path d="M140 20a60 60 0 00-60 60h60zM80 200a60 60 0 0060-60H80zM50 80a30 30 0 0130 30 30 30 0 01-30 30 30 30 0 01-30-30 30 30 0 0130-30zm60 0a30 30 0 0130 30 30 30 0 01-30 30 30 30 0 01-30-30 30 30 0 0130-30zm60 0a30 30 0 0130 30 30 30 0 01-30 30 30 30 0 01-30-30 30 30 0 0130-30"/><path d="M80 20a60 60 0 0160 60H80zm60 180a60 60 0 01-60-60h60zM20 20a60 60 0 0160 60H20zm0 180a60 60 0 0060-60H20zM200 20a60 60 0 00-60 60h60zm0 180a60 60 0 01-60-60h60z"/></svg></a>
					<a rel="me" href="https://github.com/flber" aria-label="Github account" title="Github account"><svg class="octicon octicon-mark-github v-align-middle" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a>
		        	<span class="dark"><a href='https://webring.xxiivv.com/#random' target='_blank'><img class="webring" src='https://webring.xxiivv.com/icon.black.svg' alt="a white on black symbol of the webring"/></a></span> 
		        	<span class="light"><a href='https://webring.xxiivv.com/#random' target='_blank'><img class="webring" src='https://webring.xxiivv.com/icon.white.svg' alt="a white on black symbol of the webring"/></a></span> 
				</div>
				<div style="float: right; margin-top: -6px;">
					<em>Last updated: 250421</em>
				</div>
			</nav>
		</footer>
	</body>
</html>
